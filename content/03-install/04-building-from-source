# Building Mantis from source

You can build the Mantis client from source as an alternative to its downloading. You can do so using SBT or Nix.

## SBT

### Requirements to build with SBT
- JDK 1.8 (download from java.com)
- SBT (download sbt)
- Python 2.7.15 (download from python.org)

### Build the client

1. To build the client, first, download the repository and cd into the root directory:

```
git clone git@github.com:input-output-hk/mantis.git
cd mantis
```

2. Use sbt to create the client's distribution:

```
git submodule update --recursive --init
sbt dist
```

This updates all submodules and creates a distribution zip in .<mantis-install-folder>/target/universal/.

As an alternative to building with SBT, you can use Nix.

## Nix

### Requirements to build with Nix

- Nix (Install instructions on https://github.com/NixOS/nix#installation)
- To load environment variables, run. /home/<user>/.nix-profile/etc/profile.d/nix.sh

### Build the client

1. To build the client, first, use the `nix-build` command, which will build project files:

```
nix-build
```

2. Then, regenerate lock files:

```
Nix-shell
sbtix-gen-all2
```

### What to do in case of failure

If Nix build fails during the "ensure Nix expressions are up-to-date" step, check the artifacts of that step. There should be a patch provided, which you can apply locally with:
patch -p1 < downloaded.patch

This patch will update the lock files for you.

### Why so many lock files?

- repo.nix : this file is generated by the sbtix-gen command and includes only the build dependencies for the project.
- project/repo.nix : this file is generated by the sbtix-gen-all command, includes only the plugin dependencies, and also generates repo.nix.
- project/project/repo.nix : this file is generated by the sbtix-gen-all2 command and includes only the plugin dependencies. It also generates repo.nix and project/repo.nix.

### Getting an error: unsupported argument 'submodules' to 'fetchGit'

To resolve this issue, please make sure to update your version of Nix. fetchGit support for submodules is relatively recent.

Update the version of Nix you are using, otherwise:
- Remove the "submodules = true;" argument from fetchGit (in ./nix/pkgs/mantis/default.nix).
- git submodule update --recursive --init
- nix-build

## Building Mantis wallet from source

### Requirements

- Node.js - v12+ (optional nvm)
- yarn - tested with 1.21.1-1.22.5

### Cloning and Initializing the project

To clone and initialize your project, run the following command:

```
	git clone git@github.com:input-output-hk/mantis-wallet.git
	cd mantis-wallet
```

Running the yarn command in the project directory will download the dependencies. After this, you can run the script below:
```
	yarn
	yarn build-renderer
	yarn build-main
	yarn electron
```
